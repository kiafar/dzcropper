/*!
 * dzCropper.js v1.0
 * https://github.com/kiafar/dzcropper
 *
 * Copyright (c) 2018 Tirdad Kiafar
 * Released under the MIT license
 *
 * 05/07/2018 @ 5:38pm (UTC)
 */
!function(e,a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(t,o){return void 0===o&&(o=void 0!==e?require("jquery"):require("jquery")(t)),a(o),o}:a(jQuery)}(this,function(e){"use strict";var a=[],t={},o={maxDimention:5e3,maxFiles:2,maxFilesize:2,acceptedFiles:"image/*",clickable:[".dropzone"],cropperOptions:{aspectRatio:1,autoCropArea:1,movable:!1,cropBoxResizable:!0,rotatable:!0},mainTemplate:'<form title="Drop images to upload, or click to browse" action="upload.php" class="dropzone" id="my-dropzone-container" method="post" enctype="multipart/form-data"><img src="img/upload.png" alt="upload" class="dz-upload-img"/><div class="fallback"><input name="file" type="file"></div></form>',modalTemplate:'<div class="modal fade" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">Crop</h4></div><div class="modal-body"><div class="image-container">\x3c!-- image goest here --\x3e</div></div><div class="modal-footer"><button type="button" class="btn btn-warning rotate-left" title="Rotate counterclockwise"><span class="fa fa-rotate-left"></span></button><button type="button" class="btn btn-warning rotate-right" title="Rotate clockwise"><span class="fa fa-rotate-right"></span></button><button type="button" class="btn btn-warning scale-x" data-value="-1" title="Flip horizontally"><span class="fa fa-arrows-h"></span></button><button type="button" class="btn btn-warning scale-y" data-value="-1" title="Flip vertically"><span class="fa fa-arrows-v"></span></button><button type="button" class="btn btn-warning reset" title="Reset to default"><span class="fa fa-refresh"></span></button><button type="button" class="btn btn-default" data-dismiss="modal" title="Close window">Cancel</button><button type="button" class="btn btn-primary crop-upload" title="Save">Done</button></div></div></div></div>',onDropzoneReady:function(){},onCropperReady:function(){},onMaxFileReached:function(){},onMaxDimentionReached:function(){}};function n(){e(".modal-backdrop").last().addClass("last"),e(".modal").last().addClass("last")}e.fn.dzCropper=function(l){(t=Object.assign({},o,void 0!==l&&l)).clickable.push(".dz-upload-img");var r=e(this),s=0,c=e(t.mainTemplate);Dropzone.autoDiscover=!1,r.append(c);var d=new Dropzone(c[0],{clickable:Array.isArray(t.clickable)&&t.clickable,autoQueue:!1,autoProcessQueue:!1,addRemoveLinks:!0,maxFilesize:t.maxFilesize,maxFiles:t.maxFiles,acceptedFiles:t.acceptedFiles,dictDefaultMessage:"Drop images here, or click to browse",dictRemoveFile:"Remove",init:function(){"function"==typeof t.onDropzoneReady&&t.onDropzoneReady(r.data("dropzone"))}});r.data("dropzone",d),d.on("addedfile",function(o){!function(o){{if(o.cropped)return;if(function(e){if(t.maxFiles<1)return!0;for(var o=[],n=0;n<d.files.length;n++){var i=d.files[n];i.cropped&&o.push(i)}{if(o.length<t.maxFiles)return!1;for(var n=0;n<a.length;n++)if((i=a[n]).name===e.name&&i.size===e.size)return!1;return!0}}(o))return d.removeFile(o),void("function"==typeof t.onMaxFileReached&&t.onMaxFileReached(t.maxFiles))}d.removeFile(o);var l=new FileReader;l.onloadend=function(){var c=new Image;c.src=l.result,c.onload=function(){var l=this.width,p=this.height;return l<=t.maxDimention&&p<=t.maxDimention?void function(o,l){o.id="img-"+ ++s;var c=e(t.modalTemplate);c.find(".image-container").append(o),c.modal({backdrop:"static",keyboard:!0}).on("shown.bs.modal",function(){n(),"object"!=typeof t.cropperOptions&&(t.cropperOptions={}),"function"!=typeof t.cropperOptions.ready&&(t.cropperOptions.ready=function(){"function"==typeof t.onCropperReady&&t.onCropperReady(r.data("cropper"))});var s=new Cropper(o,t.cropperOptions);r.data("cropper",s);var c=e(this);c.on("click",".crop-upload",function(){var e=i(s.getCroppedCanvas({fillColor:"#fff"}),"image/jpeg",.9);e.name=l.name,e.cropped=!0;for(var o=d.getAcceptedFiles(),n=0;n<o.length;n++){var r=o[n];r.name===l.name&&d.removeFile(r)}if(d.addFile(e),e.size<=1024*t.maxFilesize*1024)try{d.enqueueFile(e),d.processQueue()}catch(e){c.modal("hide")}a.push(l),c.modal("hide")}).on("hidden.bs.modal",function(e){n()}).on("click",".rotate-right",function(){s.rotate(90)}).on("click",".rotate-left",function(){s.rotate(-90)}).on("click",".reset",function(){s.reset()}).on("click",".scale-x",function(){var a=e(this);s.scaleX(a.data("value")),a.data("value",-a.data("value"))}).on("click",".scale-y",function(){var a=e(this);s.scaleY(a.data("value")),a.data("value",-a.data("value"))})})}(c,o):(d.removeFile(o),void("function"==typeof t.onMaxDimentionReached&&t.onMaxDimentionReached(l+"x"+p+" pixels",t.maxDimention+"x"+t.maxDimention+" pixels")))}},l.readAsDataURL(o)}(o)})};var i=function(e,a,t){a=a||"image/png",e.toBlob&&e.toBlob(function(e){return e},a,t);for(var o=atob(e.toDataURL(a,t).split(",")[1]),n=o.length,i=new Uint8Array(n),l=0;l<n;l++)i[l]=o.charCodeAt(l);return new Blob([i],{type:a})}});