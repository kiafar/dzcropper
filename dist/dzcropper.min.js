/*!
 * dzCropper.js v1.0
 * https://github.com/kiafar/dzcropper
 *
 * Copyright (c) 2018 Tirdad Kiafar
 * Released under the MIT license
 *
 * 05/07/2018 @ 5:38pm (UTC)
 */
!function(e,a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(t,o){return void 0===o&&(o=void 0!==e?require("jquery"):require("jquery")(t)),a(o),o}:a(jQuery)}(this,function(e){"use strict";var a=[],t={},o={maxDimention:5e3,maxFiles:2,maxFilesize:2,acceptedFiles:"image/*",clickable:[".dropzone"],cropperOptions:{aspectRatio:1,autoCropArea:1,movable:!1,cropBoxResizable:!0,rotatable:!0},mainTemplate:'<form title="Drop images to upload, or click to browse" action="upload.php" class="dropzone" id="my-dropzone-container" method="post" enctype="multipart/form-data"><img src="img/upload.png" alt="upload" class="dz-upload-img"/><div class="fallback"><input name="file" type="file"></div></form>',modalTemplate:'<div class="modal fade" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">Crop</h4></div><div class="modal-body"><div class="image-container">\x3c!-- image goest here --\x3e</div></div><div class="modal-footer"><button type="button" class="btn btn-warning rotate-left" title="Rotate counterclockwise"><span class="fa fa-rotate-left"></span></button><button type="button" class="btn btn-warning rotate-right" title="Rotate clockwise"><span class="fa fa-rotate-right"></span></button><button type="button" class="btn btn-warning scale-x" data-value="-1" title="Flip horizontally"><span class="fa fa-arrows-h"></span></button><button type="button" class="btn btn-warning scale-y" data-value="-1" title="Flip vertically"><span class="fa fa-arrows-v"></span></button><button type="button" class="btn btn-warning reset" title="Reset to default"><span class="fa fa-refresh"></span></button><button type="button" class="btn btn-default" data-dismiss="modal" title="Close window">Cancel</button><button type="button" class="btn btn-primary crop-upload" title="Save">Done</button></div></div></div></div>',onDropzoneReady:function(){},onCropperReady:function(){},onMaxFileReached:function(){},onMaxDimentionReached:function(){},onFileAdded:function(){},onFileRemoved:function(){},onSuccess:function(){}};function n(){e(".modal-backdrop").last().addClass("last"),e(".modal").last().addClass("last")}e.fn.dzCropper=function(r){(t=Object.assign({},o,void 0!==r&&r)).clickable.push(".dz-upload-img");var s=e(this),d=0,c=e(t.mainTemplate);Dropzone.autoDiscover=!1,s.append(c);var p=new Dropzone(c[0],{clickable:Array.isArray(t.clickable)&&t.clickable,autoQueue:!1,autoProcessQueue:!1,addRemoveLinks:!0,maxFilesize:t.maxFilesize,maxFiles:t.maxFiles,acceptedFiles:t.acceptedFiles,dictDefaultMessage:"Drop images here, or click to browse",dictRemoveFile:"Remove",init:function(){t.onDropzoneReady(s.data("dropzone"))}});s.data("dropzone",p),p.on("addedfile",function(o){!function(o){"number"!=typeof o.lastModified&&(o.lastModified=0);{if(o.cropped)return void t.onFileAdded(o);if(function(e){if(t.maxFiles<1)return!0;for(var o=[],n=0;n<p.files.length;n++){var i=p.files[n];i.cropped&&o.push(i)}{if(o.length<t.maxFiles)return!1;for(var n=0;n<a.length;n++)if((i=a[n]).name===e.name&&i.size===e.size)return!1;return!0}}(o))return p.removeFile(o),void t.onMaxFileReached(t.maxFiles)}p.removeFile(o);var r=new FileReader;r.onloadend=function(){var c=new Image;c.src=r.result,c.onload=function(){var r=this.width,u=this.height;return r<=t.maxDimention&&u<=t.maxDimention?void function(o,r){o.id="img-"+ ++d;var c=e(t.modalTemplate);c.find(".image-container").append(o),c.modal({backdrop:"static",keyboard:!0}).on("shown.bs.modal",function(){n(),"object"!=typeof t.cropperOptions&&(t.cropperOptions={}),"function"!=typeof t.cropperOptions.ready&&(t.cropperOptions.ready=function(){t.onCropperReady(s.data("cropper"))});var d=new Cropper(o,t.cropperOptions);s.data("cropper",d);var c=e(this);c.on("click",".crop-upload",function(){var e=i(d.getCroppedCanvas({fillColor:"#fff"}),"image/jpeg",.9);e.name=r.name,e.lastModified=r.lastModified,e.uid=Math.abs(l(r.name+r.size+r.lastModified)),e.cropped=!0;for(var o=p.getAcceptedFiles(),n=0;n<o.length;n++){var s=o[n];s.name===r.name&&p.removeFile(s)}p.addFile(e),e.size<=1024*t.maxFilesize*1024&&(p.enqueueFile(e),p.processQueue()),r.croppedFile={name:e.name,size:e.size,lastModified:e.lastModified,uid:e.uid},a.push(r),c.modal("hide")}).on("hidden.bs.modal",function(e){n()}).on("click",".rotate-right",function(){d.rotate(90)}).on("click",".rotate-left",function(){d.rotate(-90)}).on("click",".reset",function(){d.reset()}).on("click",".scale-x",function(){var a=e(this);d.scaleX(a.data("value")),a.data("value",-a.data("value"))}).on("click",".scale-y",function(){var a=e(this);d.scaleY(a.data("value")),a.data("value",-a.data("value"))})})}(c,o):(p.removeFile(o),void t.onMaxDimentionReached(r+"x"+u+" pixels",t.maxDimention+"x"+t.maxDimention+" pixels"))}},r.readAsDataURL(o)}(o)}),p.on("success",function(e){t.onSuccess(e)}),p.on("removedfile",function(e){if(e.cropped){for(var o,n=0;n<a.length;n++){var i=a[n];if(i.croppedFile.uid===e.uid){o=i;break}}a.splice(a.indexOf(o),1),t.onFileRemoved(e)}})};var i=function(e,a,t){a=a||"image/png",e.toBlob&&e.toBlob(function(e){return e},a,t);for(var o=atob(e.toDataURL(a,t).split(",")[1]),n=o.length,i=new Uint8Array(n),l=0;l<n;l++)i[l]=o.charCodeAt(l);return new Blob([i],{type:a})},l=function(e){var a=0;if(0==e.length)return a;for(var t=0;t<e.length;t++){a=(a<<5)-a+e.charCodeAt(t),a&=a}return a}});
